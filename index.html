<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PhonePe Analytics Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #6739b7;
      --primary-dark: #51279b;
      --secondary: #11cdef;
      --success: #2dce89;
      --info: #5e72e4;
      --warning: #fb6340;
      --danger: #f5365c;
      --light: #f8f9fa;
      --dark: #212529;
      --gray-100: #f6f9fc;
      --gray-200: #e9ecef;
      --gray-300: #dee2e6;
      --gray-400: #ced4da;
      --gray-500: #adb5bd;
      --gray-600: #8898aa;
      --gray-700: #525f7f;
      --gray-800: #32325d;
      --gray-900: #212529;
      --border-radius: 0.75rem;
      --box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--gray-100);
      color: var(--gray-800);
      line-height: 1.6;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 15px;
    }

    /* Header Styles */
    header {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      padding: 1.5rem 0;
      box-shadow: var(--box-shadow);
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo img {
      height: 40px;
    }

    .logo h1 {
      font-size: 1.8rem;
      font-weight: 700;
    }

    .nav-links {
      display: flex;
      gap: 20px;
    }

    .nav-links a {
      color: white;
      text-decoration: none;
      font-weight: 500;
      padding: 5px 10px;
      border-radius: 4px;
      transition: background 0.3s;
    }

    .nav-links a:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    /* Dashboard Styles */
    .dashboard {
      padding: 2rem 0;
    }

    .dashboard-header {
      margin-bottom: 2rem;
    }

    .dashboard-header h2 {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--gray-800);
    }

    /* Summary Cards */
    .summary-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .summary-card {
      background: white;
      border-radius: var(--border-radius);
      padding: 1.5rem;
      box-shadow: var(--box-shadow);
      display: flex;
      align-items: center;
    }

    .summary-card-icon {
      width: 60px;
      height: 60px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
      font-size: 1.5rem;
    }

    .icon-primary {
      background: rgba(103, 57, 183, 0.1);
      color: var(--primary);
    }

    .icon-success {
      background: rgba(45, 206, 137, 0.1);
      color: var(--success);
    }

    .icon-info {
      background: rgba(94, 114, 228, 0.1);
      color: var(--info);
    }

    .icon-warning {
      background: rgba(251, 99, 64, 0.1);
      color: var(--warning);
    }

    .summary-card-content h3 {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 5px;
    }

    .summary-card-content p {
      color: var(--gray-600);
      font-size: 0.9rem;
    }

    /* Charts Grid */
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
      gap: 25px;
      margin-bottom: 30px;
    }

    .chart-card {
      background: white;
      border-radius: var(--border-radius);
      padding: 1.5rem;
      box-shadow: var(--box-shadow);
    }

    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .chart-header h3 {
      font-size: 1.1rem;
      font-weight: 600;
    }

    .chart-actions {
      display: flex;
      gap: 10px;
    }

    .chart-actions button {
      background: none;
      border: none;
      color: var(--gray-600);
      cursor: pointer;
      font-size: 1rem;
    }

    .chart-container {
      position: relative;
      height: 300px;
      width: 100%;
    }

    /* Map Container */
    .map-container {
      background: white;
      border-radius: var(--border-radius);
      padding: 1.5rem;
      box-shadow: var(--box-shadow);
      margin-bottom: 30px;
    }

    .map-placeholder {
      height: 500px;
      background: var(--gray-100);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--gray-600);
      overflow: hidden;
      position: relative;
    }

    #india-map {
      width: 100%;
      height: 100%;
    }

    .state {
      fill: #d4d8dd;
      stroke: #fff;
      stroke-width: 1.5;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .state:hover {
      fill: var(--primary);
      stroke-width: 2;
    }

    .state-highlight {
      fill: var(--primary);
      stroke-width: 2;
    }

    .map-tooltip {
      position: absolute;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 4px;
      padding: 8px 12px;
      font-size: 14px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      pointer-events: none;
      z-index: 100;
      transition: opacity 0.3s;
      opacity: 0;
    }

    .map-legend {
      display: flex;
      justify-content: center;
      margin-top: 15px;
      gap: 20px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 12px;
    }

    .legend-color {
      width: 15px;
      height: 15px;
      border-radius: 3px;
    }

    /* Footer */
    footer {
      background: white;
      padding: 1.5rem 0;
      text-align: center;
      color: var(--gray-600);
      margin-top: 2rem;
      border-top: 1px solid var(--gray-200);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .charts-grid {
        grid-template-columns: 1fr;
      }
      
      .header-content {
        flex-direction: column;
        gap: 15px;
      }
      
      .nav-links {
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .map-placeholder {
        height: 400px;
      }
    }

    /* Loading animation */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(103, 57, 183, 0.3);
      border-radius: 50%;
      border-top-color: var(--primary);
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Demographics Tabs */
    .demographics-tabs {
      display: flex;
      gap: 5px;
      margin-top: 10px;
    }

    .tab-button {
      padding: 6px 12px;
      background-color: var(--gray-200);
      border: none;
      border-radius: 4px;
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .tab-button:hover {
      background-color: var(--gray-300);
    }

    .tab-button.active {
      background-color: var(--primary);
      color: white;
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <div class="header-content">
        <div class="logo">
          <i class="fas fa-mobile-alt"></i>
          <h1>PhonePe Analytics Dashboard</h1>
        </div>
        <div class="nav-links">
          <a href="#"><i class="fas fa-home"></i> Dashboard</a>
          <a href="#"><i class="fas fa-chart-bar"></i> Analytics</a>
          <a href="#"><i class="fas fa-cog"></i> Settings</a>
          <a href="#"><i class="fas fa-user"></i> Profile</a>
        </div>
      </div>
    </div>
  </header>

  <main class="dashboard">
    <div class="container">
      <div class="dashboard-header">
        <h2>User Analytics Overview</h2>
      </div>

      <!-- Summary Cards -->
      <div class="summary-cards">
        <div class="summary-card">
          <div class="summary-card-icon icon-primary">
            <i class="fas fa-users"></i>
          </div>
          <div class="summary-card-content">
            <h3 id="totalUsers">-</h3>
            <p>Total Users</p>
          </div>
        </div>

        <div class="summary-card">
          <div class="summary-card-icon icon-success">
            <i class="fas fa-university"></i>
          </div>
          <div class="summary-card-content">
            <h3 id="popularBank">-</h3>
            <p>Most Popular Bank</p>
          </div>
        </div>

        <div class="summary-card">
          <div class="summary-card-icon icon-info">
            <i class="fas fa-map-marker-alt"></i>
          </div>
          <div class="summary-card-content">
            <h3 id="popularState">-</h3>
            <p>Most Popular State</p>
          </div>
        </div>

        <div class="summary-card">
          <div class="summary-card-icon icon-warning">
            <i class="fas fa-money-bill-wave"></i>
          </div>
          <div class="summary-card-content">
            <h3 id="transactionVolume">-</h3>
            <p>Transaction Volume</p>
          </div>
        </div>
      </div>

      <!-- Charts Grid -->
      <div class="charts-grid">
        <div class="chart-card">
          <div class="chart-header">
            <h3>Top Banks Used by Users</h3>
            <div class="chart-actions">
              <button><i class="fas fa-download"></i></button>
              <button><i class="fas fa-expand"></i></button>
            </div>
          </div>
          <div class="chart-container">
            <canvas id="bankChart"></canvas>
          </div>
        </div>

        <div class="chart-card">
          <div class="chart-header">
            <h3>Top States with Most Users</h3>
            <div class="chart-actions">
              <button><i class="fas fa-download"></i></button>
              <button><i class="fas fa-expand"></i></button>
            </div>
          </div>
          <div class="chart-container">
            <canvas id="stateChart"></canvas>
          </div>
        </div>

        <div class="chart-card">
          <div class="chart-header">
            <h3>Most Common Email Domains</h3>
            <div class="chart-actions">
              <button><i class="fas fa-download"></i></button>
              <button><i class="fas fa-expand"></i></button>
            </div>
          </div>
          <div class="chart-container">
            <canvas id="domainChart"></canvas>
          </div>
        </div>

        <div class="chart-card">
          <div class="chart-header">
            <h3>User Demographics</h3>
            <div class="chart-actions">
              <button><i class="fas fa-download"></i></button>
              <button><i class="fas fa-expand"></i></button>
            </div>
          </div>
          <div class="chart-container">
            <canvas id="demographicsChart"></canvas>
          </div>
        </div>

        <div class="chart-card">
          <div class="chart-header">
            <h3>Transaction Trends</h3>
            <div class="chart-actions">
              <button><i class="fas fa-download"></i></button>
              <button><i class="fas fa-expand"></i></button>
            </div>
          </div>
          <div class="chart-container">
            <canvas id="transactionTrendsChart"></canvas>
          </div>
        </div>

        <div class="chart-card">
          <div class="chart-header">
            <h3>State-wise Transaction Volume</h3>
            <div class="chart-actions">
              <button><i class="fas fa-download"></i></button>
              <button><i class="fas fa-expand"></i></button>
            </div>
          </div>
          <div class="chart-container">
            <canvas id="stateTransactionChart"></canvas>
          </div>
        </div>
      </div>

      <!-- India Map Visualization -->
      <div class="map-container">
        <div class="chart-header">
          <h3>User Distribution Across India</h3>
          <div class="chart-actions">
            <button><i class="fas fa-download"></i></button>
            <button><i class="fas fa-expand"></i></button>
          </div>
        </div>
        <div class="map-placeholder">
          <svg id="india-map" viewBox="0 0 900 1000" preserveAspectRatio="xMidYMid meet">
            <!-- Simplified Indian states SVG paths -->
            <path id="jk" class="state" d="M300,100 L350,120 L340,160 L290,140 Z" data-state="Jammu and Kashmir" />
            <path id="hp" class="state" d="M320,180 L370,200 L360,240 L310,220 Z" data-state="Himachal Pradesh" />
            <path id="pb" class="state" d="M280,240 L330,260 L320,300 L270,280 Z" data-state="Punjab" />
            <path id="hr" class="state" d="M320,280 L370,300 L360,340 L310,320 Z" data-state="Haryana" />
            <path id="dl" class="state" d="M340,320 L350,330 L345,335 L335,325 Z" data-state="Delhi" />
            <path id="up" class="state" d="M320,340 L370,360 L360,400 L310,380 Z" data-state="Uttar Pradesh" />
            <path id="uk" class="state" d="M380,240 L430,260 L420,300 L370,280 Z" data-state="Uttarakhand" />
            <path id="rj" class="state" d="M260,360 L310,380 L300,420 L250,400 Z" data-state="Rajasthan" />
            <path id="gj" class="state" d="M200,420 L250,440 L240,480 L190,460 Z" data-state="Gujarat" />
            <path id="mp" class="state" d="M300,420 L350,440 L340,480 L290,460 Z" data-state="Madhya Pradesh" />
            <path id="mh" class="state" d="M240,480 L290,500 L280,540 L230,520 Z" data-state="Maharashtra" />
            <path id="br" class="state" d="M400,420 L450,440 L440,480 L390,460 Z" data-state="Bihar" />
            <path id="jh" class="state" d="M420,460 L470,480 L460,520 L410,500 Z" data-state="Jharkhand" />
            <path id="wb" class="state" d="M460,460 L510,480 L500,520 L450,500 Z" data-state="West Bengal" />
            <path id="sk" class="state" d="M480,420 L490,425 L485,430 L475,425 Z" data-state="Sikkim" />
            <path id="as" class="state" d="M520,440 L570,460 L560,500 L510,480 Z" data-state="Assam" />
            <path id="nl" class="state" d="M540,400 L550,405 L545,410 L535,405 Z" data-state="Nagaland" />
            <path id="mn" class="state" d="M560,400 L570,405 L565,410 L555,405 Z" data-state="Manipur" />
            <path id="mz" class="state" d="M550,420 L560,425 L555,430 L545,425 Z" data-state="Mizoram" />
            <path id="tr" class="state" d="M530,420 L540,425 L535,430 L525,425 Z" data-state="Tripura" />
            <path id="ml" class="state" d="M520,400 L530,405 L525,410 L515,405 Z" data-state="Meghalaya" />
            <path id="ap" class="state" d="M320,540 L370,560 L360,600 L310,580 Z" data-state="Andhra Pradesh" />
            <path id="ka" class="state" d="M260,540 L310,560 L300,600 L250,580 Z" data-state="Karnataka" />
            <path id="kl" class="state" d="M240,620 L290,640 L280,680 L230,660 Z" data-state="Kerala" />
            <path id="tn" class="state" d="M300,620 L350,640 L340,680 L290,660 Z" data-state="Tamil Nadu" />
            <path id="od" class="state" d="M380,520 L430,540 L420,580 L370,560 Z" data-state="Odisha" />
            <path id="tg" class="state" d="M320,580 L340,590 L330,610 L310,600 Z" data-state="Telangana" />
            <path id="ga" class="state" d="M240,580 L260,590 L250,610 L230,600 Z" data-state="Goa" />
            <path id="ch" class="state" d="M340,500 L350,510 L345,515 L335,505 Z" data-state="Chhattisgarh" />
          </svg>
          <div class="map-tooltip" id="map-tooltip"></div>
          <div class="map-legend">
            <div class="legend-item">
              <div class="legend-color" style="background-color: #d4d8dd;"></div>
              <span>Low Users</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background-color: #a3a9f0;"></div>
              <span>Medium Users</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background-color: #6739b7;"></div>
              <span>High Users</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <div class="container">
      <p>© 2023 PhonePe Analytics Dashboard | Data updated: <span id="currentDate"></span></p>
    </div>
  </footer>

  <script>
    // Set current date in footer
    document.getElementById('currentDate').textContent = new Date().toLocaleDateString();

    // Color palette for charts
    const chartColors = [
      '#6739b7', '#11cdef', '#2dce89', '#fb6340', '#f5365c',
      '#5e72e4', '#f7fafc', '#8898aa', '#e9ecef', '#525f7f'
    ];

    // Format numbers with commas
    function formatNumber(num) {
      if (num === null || num === undefined) return 'N/A';
      return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    // Format currency
    function formatCurrency(amount) {
      if (amount === null || amount === undefined) return 'N/A';
      if (amount >= 10000000) {
        return '₹' + (amount / 10000000).toFixed(2) + ' Cr';
      } else if (amount >= 100000) {
        return '₹' + (amount / 100000).toFixed(2) + ' L';
      } else {
        return '₹' + formatNumber(Math.round(amount));
      }
    }

    // Generate mock user demographics data
    function generateMockDemographics() {
      return {
        "age_groups": {
          "18-24": Math.floor(Math.random() * 1000) + 500,
          "25-34": Math.floor(Math.random() * 2000) + 1500,
          "35-44": Math.floor(Math.random() * 1500) + 1000,
          "45-54": Math.floor(Math.random() * 800) + 400,
          "55+": Math.floor(Math.random() * 500) + 200,
          "Under 18": Math.floor(Math.random() * 300) + 100
        },
        "genders": {
          "Male": Math.floor(Math.random() * 4000) + 2000,
          "Female": Math.floor(Math.random() * 3500) + 1800,
          "Other": Math.floor(Math.random() * 100) + 50
        }
      };
    }

    // Generate mock transaction trends data
    function generateMockTransactionTrends() {
      const months = ['Jan 2023', 'Feb 2023', 'Mar 2023', 'Apr 2023', 'May 2023', 'Jun 2023', 
                      'Jul 2023', 'Aug 2023', 'Sep 2023', 'Oct 2023', 'Nov 2023', 'Dec 2023'];
      
      const trends = [];
      let baseAmount = 5000000;
      
      months.forEach(month => {
        const fluctuation = Math.random() * 0.3 - 0.15; // -15% to +15%
        const amount = baseAmount * (1 + fluctuation);
        const count = Math.floor(amount / (Math.random() * 900 + 100)); // Random transaction count
        
        trends.push({
          Month: month,
          Total_Amount: Math.round(amount),
          Transaction_Count: count
        });
        
        baseAmount = amount * (1 + (Math.random() * 0.05)); // Slight upward trend
      });
      
      return trends;
    }

    // Generate mock state-wise transaction data
    function generateMockStateTransactions() {
      const indianStates = [
        "Maharashtra", "Uttar Pradesh", "Karnataka", "Tamil Nadu", "Gujarat",
        "Rajasthan", "West Bengal", "Madhya Pradesh", "Kerala", "Andhra Pradesh",
        "Punjab", "Haryana", "Bihar", "Odisha", "Telangana"
      ];
      
      const stateData = {};
      
      indianStates.forEach(state => {
        stateData[state] = {
          user_count: Math.floor(Math.random() * 5000) + 1000,
          Transaction_Amount: Math.floor(Math.random() * 100000000) + 50000000
        };
      });
      
      return stateData;
    }

    // Generate mock state-wise user data for the map
    function generateMockStateUserData() {
      return {
        "Jammu and Kashmir": Math.floor(Math.random() * 500) + 200,
        "Himachal Pradesh": Math.floor(Math.random() * 800) + 300,
        "Punjab": Math.floor(Math.random() * 1500) + 1000,
        "Haryana": Math.floor(Math.random() * 1200) + 800,
        "Delhi": Math.floor(Math.random() * 2000) + 1500,
        "Uttar Pradesh": Math.floor(Math.random() * 3000) + 2000,
        "Uttarakhand": Math.floor(Math.random() * 700) + 400,
        "Rajasthan": Math.floor(Math.random() * 1800) + 1200,
        "Gujarat": Math.floor(Math.random() * 2200) + 1500,
        "Madhya Pradesh": Math.floor(Math.random() * 1600) + 1000,
        "Maharashtra": Math.floor(Math.random() * 3500) + 2500,
        "Bihar": Math.floor(Math.random() * 1900) + 1300,
        "Jharkhand": Math.floor(Math.random() * 1100) + 700,
        "West Bengal": Math.floor(Math.random() * 2400) + 1800,
        "Sikkim": Math.floor(Math.random() * 200) + 100,
        "Assam": Math.floor(Math.random() * 900) + 600,
        "Nagaland": Math.floor(Math.random() * 300) + 150,
        "Manipur": Math.floor(Math.random() * 400) + 200,
        "Mizoram": Math.floor(Math.random() * 250) + 150,
        "Tripura": Math.floor(Math.random() * 350) + 200,
        "Meghalaya": Math.floor(Math.random() * 300) + 180,
        "Andhra Pradesh": Math.floor(Math.random() * 2000) + 1400,
        "Karnataka": Math.floor(Math.random() * 2300) + 1600,
        "Kerala": Math.floor(Math.random() * 1800) + 1200,
        "Tamil Nadu": Math.floor(Math.random() * 2500) + 1800,
        "Odisha": Math.floor(Math.random() * 1300) + 800,
        "Telangana": Math.floor(Math.random() * 1900) + 1300,
        "Goa": Math.floor(Math.random() * 600) + 300,
        "Chhattisgarh": Math.floor(Math.random() * 900) + 500
      };
    }

    // Initialize India Map with mock data
    function initializeIndiaMap() {
      const tooltip = document.getElementById('map-tooltip');
      const stateUserData = generateMockStateUserData();
      
      // Find max and min values for color scaling
      const values = Object.values(stateUserData);
      const maxUsers = Math.max(...values);
      const minUsers = Math.min(...values);
      
      // Apply colors to states based on user count
      document.querySelectorAll('.state').forEach(state => {
        const stateName = state.getAttribute('data-state');
        const userCount = stateUserData[stateName] || 0;
        
        // Calculate color intensity based on user count
        const intensity = (userCount - minUsers) / (maxUsers - minUsers);
        let color;
        
        if (intensity < 0.33) {
          color = '#d4d8dd'; // Light color for low values
        } else if (intensity < 0.66) {
          color = '#a3a9f0'; // Medium color for medium values
        } else {
          color = '#6739b7'; // Dark color for high values
        }
        
        state.setAttribute('fill', color);
        state.setAttribute('data-users', userCount);
        
        // Add hover effects
        state.addEventListener('mouseover', function(e) {
          this.classList.add('state-highlight');
          
          // Show tooltip
          tooltip.innerHTML = `<strong>${stateName}</strong><br>Users: ${formatNumber(userCount)}`;
          tooltip.style.opacity = '1';
          tooltip.style.left = (e.pageX + 10) + 'px';
          tooltip.style.top = (e.pageY - 28) + 'px';
        });
        
        state.addEventListener('mouseout', function() {
          this.classList.remove('state-highlight');
          tooltip.style.opacity = '0';
        });
        
        state.addEventListener('mousemove', function(e) {
          tooltip.style.left = (e.pageX + 10) + 'px';
          tooltip.style.top = (e.pageY - 28) + 'px';
        });
      });
    }

    // Fetch data from API
    async function fetchData(endpoint) {
      try {
        const res = await fetch(endpoint);
        if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
        return await res.json();
      } catch (error) {
        console.error('Error fetching data:', error);
        return null;
      }
    }

    // Render chart function
    function renderChart(ctx, type, data, label, options = {}) {
      const defaultOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom',
            labels: {
              padding: 20,
              usePointStyle: true,
            }
          },
          tooltip: {
            mode: 'index',
            intersect: false
          }
        }
      };

      const mergedOptions = {...defaultOptions, ...options};
      
      return new Chart(ctx, {
        type: type,
        data: {
          labels: Object.keys(data),
          datasets: [{
            label: label,
            data: Object.values(data),
            backgroundColor: chartColors,
            borderColor: type === 'line' ? chartColors[0] : undefined,
            borderWidth: type === 'line' ? 3 : 1,
            fill: type === 'line' ? false : undefined,
            tension: type === 'line' ? 0.1 : undefined
          }]
        },
        options: mergedOptions
      });
    }

    // Render bar chart with specific options
    function renderBarChart(ctx, data, label) {
      return renderChart(ctx, 'bar', data, label, {
        scales: {
          y: {
            beginAtZero: true,
            grid: {
              drawBorder: false
            }
          },
          x: {
            grid: {
              display: false
            }
          }
        }
      });
    }

    // Render line chart for trends
    function renderLineChart(ctx, data, label) {
      return renderChart(ctx, 'line', data, label, {
        scales: {
          y: {
            beginAtZero: true,
            grid: {
              drawBorder: false
            }
          },
          x: {
            grid: {
              display: false
            }
          }
        }
      });
    }

    // Render demographics chart with both age groups and gender
    function renderDemographicsChart(ctx, demographicsData) {
      // Create tabs for switching between age groups and gender
      const chartContainer = ctx.parentElement;
      const chartHeader = chartContainer.previousElementSibling;
      
      // Add tabs to the chart header
      if (!chartHeader.querySelector('.demographics-tabs')) {
        const tabsHtml = `
          <div class="demographics-tabs" style="display: flex; gap: 10px; margin-top: 10px;">
            <button class="tab-button active" data-tab="age">Age Groups</button>
            <button class="tab-button" data-tab="gender">Gender</button>
          </div>
        `;
        chartHeader.insertAdjacentHTML('beforeend', tabsHtml);
        
        // Add tab click event listeners
        const tabButtons = chartHeader.querySelectorAll('.tab-button');
        tabButtons.forEach(button => {
          button.addEventListener('click', function() {
            // Remove active class from all buttons
            tabButtons.forEach(btn => btn.classList.remove('active'));
            // Add active class to clicked button
            this.classList.add('active');
            
            // Update chart based on selected tab
            const tab = this.getAttribute('data-tab');
            updateDemographicsChart(tab);
          });
        });
      }
      
      // Store the demographics data for later use
      ctx.demographicsData = demographicsData;
      
      // Initial chart render
      updateDemographicsChart('age');
      
      function updateDemographicsChart(tab) {
        let data, label;
        
        if (tab === 'age') {
          data = demographicsData.age_groups;
          label = "Users by Age Group";
        } else {
          data = demographicsData.genders;
          label = "Users by Gender";
        }
        
        // Destroy existing chart if it exists
        if (ctx.chartInstance) {
          ctx.chartInstance.destroy();
        }
        
        // Create new chart
        ctx.chartInstance = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: Object.keys(data),
            datasets: [{
              label: label,
              data: Object.values(data),
              backgroundColor: chartColors,
              borderColor: '#fff',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'bottom',
                labels: {
                  padding: 20,
                  usePointStyle: true,
                }
              },
              tooltip: {
                mode: 'index',
                intersect: false
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                grid: {
                  drawBorder: false
                },
                ticks: {
                  callback: function(value) {
                    return value.toLocaleString();
                  }
                }
              },
              x: {
                grid: {
                  display: false
                }
              }
            }
          }
        });
      }
    }

    // Initialize dashboard
    async function initializeDashboard() {
      try {
        // Update summary cards
        const summary = await fetchData("/api/summary");
        if (summary) {
          document.getElementById('totalUsers').textContent = formatNumber(summary.total_users);
          document.getElementById('popularBank').textContent = summary.popular_bank;
          document.getElementById('popularState').textContent = summary.popular_state;
          document.getElementById('transactionVolume').textContent = formatCurrency(summary.transaction_volume);
        } else {
          // Use mock data for summary if API fails
          document.getElementById('totalUsers').textContent = "12,458";
          document.getElementById('popularBank').textContent = "State Bank of India";
          document.getElementById('popularState').textContent = "Maharashtra";
          document.getElementById('transactionVolume').textContent = "₹142.75 Cr";
        }

        // Render charts
        const bankData = await fetchData("/api/popular-banks");
        if (bankData) {
          renderBarChart(
            document.getElementById("bankChart"), 
            bankData, 
            "Users by Bank"
          );
        } else {
          // Mock bank data
          const mockBankData = {
            "State Bank of India": 2450,
            "HDFC Bank": 1980,
            "ICICI Bank": 1765,
            "Axis Bank": 1520,
            "Kotak Mahindra Bank": 1230,
            "Punjab National Bank": 980,
            "Bank of Baroda": 875,
            "Canara Bank": 760,
            "Union Bank of India": 680,
            "IndusInd Bank": 620
          };
          renderBarChart(
            document.getElementById("bankChart"), 
            mockBankData, 
            "Users by Bank"
          );
        }

        const stateData = await fetchData("/api/popular-states");
        if (stateData) {
          renderChart(
            document.getElementById("stateChart"), 
            "pie", 
            stateData, 
            "Users by State"
          );
        } else {
          // Mock state data
          const mockStateData = {
            "Maharashtra": 2150,
            "Uttar Pradesh": 1980,
            "Karnataka": 1765,
            "Tamil Nadu": 1620,
            "Gujarat": 1420,
            "Rajasthan": 1320,
            "West Bengal": 1250,
            "Madhya Pradesh": 1180,
            "Kerala": 980,
            "Andhra Pradesh": 920
          };
          renderChart(
            document.getElementById("stateChart"), 
            "pie", 
            mockStateData, 
            "Users by State"
          );
        }

        const domainData = await fetchData("/api/email-domains");
        if (domainData) {
          renderChart(
            document.getElementById("domainChart"), 
            "doughnut", 
            domainData, 
            "Email Domains"
          );
        } else {
          // Mock email domain data
          const mockDomainData = {
            "gmail.com": 4250,
            "yahoo.com": 1980,
            "hotmail.com": 1560,
            "outlook.com": 1320,
            "rediffmail.com": 980,
            "icloud.com": 760,
            "protonmail.com": 520,
            "aol.com": 420,
            "zoho.com": 380,
            "mail.com": 290
          };
          renderChart(
            document.getElementById("domainChart"), 
            "doughnut", 
            mockDomainData, 
            "Email Domains"
          );
        }

        // User Demographics - use mock data if API returns empty
        let demographicsData = await fetchData("/api/user-demographics");
        if (!demographicsData || Object.keys(demographicsData).length === 0) {
          demographicsData = generateMockDemographics();
          console.log("Using mock demographics data");
        }
        
        if (demographicsData.age_groups || demographicsData.genders) {
          renderDemographicsChart(
            document.getElementById("demographicsChart"), 
            demographicsData
          );
        }

        // Transaction Trends - use mock data if API returns empty
        let trendsData = await fetchData("/api/transaction-trends");
        if (!trendsData || trendsData.length === 0) {
          trendsData = generateMockTransactionTrends();
          console.log("Using mock transaction trends data");
        }
        
        if (trendsData.length > 0) {
          // Process trends data for chart
          const months = trendsData.map(item => item.Month);
          const amounts = trendsData.map(item => item.Total_Amount);
          
          const trendDataObj = {};
          months.forEach((month, i) => {
            trendDataObj[month] = amounts[i];
          });
          
          renderLineChart(
            document.getElementById("transactionTrendsChart"), 
            trendDataObj, 
            "Transaction Volume"
          );
        }

        // State-wise Transactions - use mock data if API returns empty
        let stateWiseData = await fetchData("/api/state-wise-data");
        if (!stateWiseData || Object.keys(stateWiseData).length === 0) {
          stateWiseData = generateMockStateTransactions();
          console.log("Using mock state-wise transaction data");
        }
        
        // Process state-wise transaction data
        const stateTransactions = {};
        for (const [state, data] of Object.entries(stateWiseData)) {
          if (data.Transaction_Amount) {
            stateTransactions[state] = data.Transaction_Amount;
          }
        }
        
        if (Object.keys(stateTransactions).length > 0) {
          renderBarChart(
            document.getElementById("stateTransactionChart"), 
            stateTransactions, 
            "Transaction Amount by State"
          );
        }

        // Initialize India Map with mock data
        initializeIndiaMap();

      } catch (error) {
        console.error("Error initializing dashboard:", error);
      }
    }





